directive @key(fields: String!) repeatable on OBJECT | INTERFACE

# User type for authentication and authorization
type User @key(fields: "id") {
  id: ID!
  email: String!
  displayName: String
  enabled: Boolean!
  roles: [Role!]!
  groups: [Group!]!
  permissions: [Permission!]!
}

# Query type for security operations
type Query {
  # Authentication queries
  currentUser: User
  
  # Authorization queries
  checkPermission(userId: ID!, permission: String!, resourceId: ID): AuthorizationResult!
  
  # Authorization management queries
  users(first: Int, after: String, query: String): UserConnection!
  groups(first: Int, after: String, query: String): GroupConnection!
  roles(first: Int, after: String, query: String): RoleConnection!
  permissions(first: Int, after: String, query: String): PermissionConnection!
}

# Mutation type for security operations
type Mutation {
  # Authentication mutations
  signIn(input: SignInInput!): SignInPayload!
  signInWithOAuth(input: SignInWithOAuthInput!): SignInPayload!
  signUp(input: SignUpInput!): SignUpPayload!
  requestPasswordReset(input: RequestPasswordResetInput!): RequestPasswordResetPayload!
  resetPassword(input: ResetPasswordInput!): ResetPasswordPayload!
  
  # Authorization management mutations
  enableUser(userId: ID!): User!
  disableUser(userId: ID!): User!
  createGroup(input: CreateGroupInput!): Group!
  updateGroup(groupId: ID!, input: UpdateGroupInput!): Group!
  deleteGroup(groupId: ID!): Boolean!
  createRole(input: CreateRoleInput!): Role!
  updateRole(roleId: ID!, input: UpdateRoleInput!): Role!
  deleteRole(roleId: ID!): Boolean!
  assignPermissionToRole(roleId: ID!, permissionId: ID!): Role!
  removePermissionFromRole(roleId: ID!, permissionId: ID!): Role!
  assignRoleToUser(userId: ID!, roleId: ID!): User!
  removeRoleFromUser(userId: ID!, roleId: ID!): User!
  assignRoleToGroup(groupId: ID!, roleId: ID!): Group!
  removeRoleFromGroup(groupId: ID!, roleId: ID!): Group!
}

# Authentication input types
input SignInInput {
  email: String!
  password: String!
  rememberMe: Boolean
}

input SignInWithOAuthInput {
  provider: String!  # "google", "microsoft", etc.
  idToken: String!   # OAuth ID token (JWT) from the provider
  rememberMe: Boolean
}

type SignInPayload {
  token: String!
  refreshToken: String
  user: User!
}

# Sign up input types
input SignUpInput {
  name: String!
  email: String!
  password: String!
}

type SignUpPayload {
  token: String!
  refreshToken: String
  user: User!
}

# Password reset input types
input RequestPasswordResetInput {
  email: String!
  locale: String
}

type RequestPasswordResetPayload {
  success: Boolean!
  message: String!
}

input ResetPasswordInput {
  token: String!
  newPassword: String!
}

type ResetPasswordPayload {
  success: Boolean!
  message: String!
}

# Authorization types
type AuthorizationResult {
  allowed: Boolean!
  reason: String!
}

type Permission @key(fields: "id") {
  id: ID!
  name: String!
  roles: [Role!]!
}

type Role @key(fields: "id") {
  id: ID!
  name: String!
  permissions: [Permission!]!
}

type Group @key(fields: "id") {
  id: ID!
  name: String!
  description: String
  roles: [Role!]!
  members: [User!]!
}

# Relay pagination types
type PageInfo {
  hasNextPage: Boolean!
  hasPreviousPage: Boolean!
  startCursor: String
  endCursor: String
}

type UserEdge {
  node: User!
  cursor: String!
}

type GroupEdge {
  node: Group!
  cursor: String!
}

type RoleEdge {
  node: Role!
  cursor: String!
}

type PermissionEdge {
  node: Permission!
  cursor: String!
}

type UserConnection {
  edges: [UserEdge!]!
  nodes: [User!]!
  pageInfo: PageInfo!
}

type GroupConnection {
  edges: [GroupEdge!]!
  nodes: [Group!]!
  pageInfo: PageInfo!
}

type RoleConnection {
  edges: [RoleEdge!]!
  nodes: [Role!]!
  pageInfo: PageInfo!
}

type PermissionConnection {
  edges: [PermissionEdge!]!
  nodes: [Permission!]!
  pageInfo: PageInfo!
}

# Input types for authorization management
input CreateGroupInput {
  name: String!
  description: String
  userIds: [ID!]
}

input UpdateGroupInput {
  name: String!
  description: String
  userIds: [ID!]
}

input CreateRoleInput {
  name: String!
}

input UpdateRoleInput {
  name: String!
}

